__Binary Used__ :  _Ransomware.wannacry.exe_

# Challenge

![Pasted image 20220923221008](PMAT-Attachments/Pasted%20image%2020220923221008.png)


# Static analysis

## Hashes

| Hash Algorithm | Hash                                                             |
| -------------- | ---------------------------------------------------------------- |
| MD5            | DB349B97C37D22F5EA1D1841E3C89EB4                                 |
| SHA256         | 24D004A104D4D54034DBCFFC2A4B19A11F39008A575AA614EA04703480B1022C |


## VirusTotal

![Pasted image 20220923221555](PMAT-Attachments/Pasted%20image%2020220923221555.png)


## Floss

![Pasted image 20220923222404](PMAT-Attachments/Pasted%20image%2020220923222404.png)

![Pasted image 20220923222910](PMAT-Attachments/Pasted%20image%2020220923222910.png)

We see a peculiar url and also some commands being run through the floss output.
Along with this, we can also observer a lot of API calls being made along with some strings which look like a password.


## PEstudio

![Pasted image 20220923223000](PMAT-Attachments/Pasted%20image%2020220923223000.png)

![Pasted image 20220923223307](PMAT-Attachments/Pasted%20image%2020220923223307.png)

![Pasted image 20220923223710](PMAT-Attachments/Pasted%20image%2020220923223710.png)

![Pasted image 20220923223756](PMAT-Attachments/Pasted%20image%2020220923223756.png)



## cutter

open the exe file in cutter and start it up. Now go to the main function and open it in graph tab.

![Pasted image 20220923224330](PMAT-Attachments/Pasted%20image%2020220923224330.png)

We can see that the url is loaded onto the stack and the _InternetOpenA_ API is called.

![Pasted image 20220923224443](PMAT-Attachments/Pasted%20image%2020220923224443.png)

Next we observer that the url is loaded onto the stack to be passed on to the _InternetOpenUrlA_ API. If it returns a false, then one set of instructions is executed, else the program quits.



# Dynamic Analysis

## Running the executable without inetsim

![Pasted image 20220923225200](PMAT-Attachments/Pasted%20image%2020220923225200.png)

## Running with inetsim

![Pasted image 20220923225828](PMAT-Attachments/Pasted%20image%2020220923225828.png)

We see nothing happens. We can also use tshark to see any DNS requests made.

```bash
tshark -f "src port 53"
```

![Pasted image 20220923225955](PMAT-Attachments/Pasted%20image%2020220923225955.png)

We see a standard query response made to the domain : 
___www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com


## Network Indicators

### Wireshark

![Pasted image 20220923230227](PMAT-Attachments/Pasted%20image%2020220923230227.png)



## Host Indicators

### Procmon

 **_Procmon Filter_**
> - Process name contains _wannacry_

![Pasted image 20220923231023](PMAT-Attachments/Pasted%20image%2020220923231023.png)

In the process tree, we can see the task it creates

![Pasted image 20220923231128](PMAT-Attachments/Pasted%20image%2020220923231128.png)

Now change the procmon filter.

**_Procmon Filter_**
> - Parent PID is _5804_


![Pasted image 20220923231312](PMAT-Attachments/Pasted%20image%2020220923231312.png)

We can see a lot of tasks run by the malware as a subprocess.

Also a folder with a random name is created.

![Pasted image 20220923231834](PMAT-Attachments/Pasted%20image%2020220923231834.png)

Opening this location

![Pasted image 20220923231922](PMAT-Attachments/Pasted%20image%2020220923231922.png)

This is the staging area for wannacry.




Final process of the malware : 
- Tries to resolve a DNS hostname
	- If successful, then does nothing
	- Else it encrypts the whole system

