# Dynamic Analysis - Part II

__Binary Used__  :  _RAT.Unknown.exe_

### Challenge -

![[Attachments/Pasted image 20220909205026.png]]

### FLOSS Output : 

![[Attachments/Pasted image 20220909210838.png]]

#### Interesting strings :

![[Attachments/Pasted image 20220909210946.png]]


## Network Based Indicators

#### Running the exe without inetsim

![[Attachments/Pasted image 20220909211112.png]]


#### Running the exe with inetsim and wireshark

![[Attachments/Pasted image 20220909211510.png]]

![[Attachments/Pasted image 20220909211604.png]]

We see an exe file being downloaded as seen from the floss output


## Host based indicators

Start Procmon and inetsim again. Reset the machine to pre-detonation and then detonante again.

> **_Procmon Filter_**
> - Process name contains _RAT.Unknown.exe_
> - Operation is _Create File_
> - Path contains _Programs\\Startup_

![[Attachments/Pasted image 20220910115449.png]]

![[Attachments/Pasted image 20220910115508.png]]

We observe that the malware downloads a file called _msdcorelib.exe_ but creates a file called _mscordll.exe_. This is used in common malware where the file downloaded and written has different names, it is called ___De-Coupling___ or ___De-Chaining___.

Also writing exe into the startup folder is a common persistence mechanism. Another thing to observer is that the initial username and the path was automatically obtained by the malware using the _%APPDATA%_ variable.

Now checking ___TcpView___ from the __Sysinternals Suite__ 

![[Attachments/Pasted image 20220910121251.png]]

We see that the malware is **listening on port 5555** on all interfaces.

Connecting to this using netcat from our remnux machine.

![[Attachments/Pasted image 20220910122016.png]]

![[Attachments/Pasted image 20220910122053.png]]

![[Attachments/Pasted image 20220910122205.png]]

We see that it is a bind shell which the attacker can connect to.

Now filter out tcp operations in Procmon.

>  **_Procmon Filter_**
> - Process name contains _RAT.Unknown.exe_
> - Operation contains _TCP_

![[Attachments/Pasted image 20220910122655.png]]

We can also observer a number of commands being run by the malware when we request it from the netcat session.

![[Attachments/Pasted image 20220910124332.png]]



Final Process of the malware :
- Checks if domain is accessible
	- If yes, downloads a file to the startup folder
	- File is written in different name
	- Starts a listener on port 5555 on all interfaces
	- A bind shell can be initiated with a base64 encoded communication