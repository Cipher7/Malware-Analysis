# Dynamic Analysis - Part III

__Binary Used__  :  _RAT.Unknown2.exe.malz_

### Challenge -

![[Attachments/Pasted image 20220910125928.png]]

### Hashes -

| Hash Algorithm | Hash                                                                                                                             |
|:--------------:| -------------------------------------------------------------------------------------------------------------------------------- |
|      MD5       | c211704777e168a5151de79dc87ffac7                                                                                                 |
|    SHA-256     | c522e0f1f9edb7e03c0a770e4c52a93db72dce21e7247322f4bbd5b053b967aab5240ce90d6aa65a79e3a3068f227346bf0190f9ca762fb8e8d076a58490d7a1 |

### Floss output -

![[Attachments/Pasted image 20220910131906.png]]

Except some information like the malware is written in Nim and there is cmd.exe being run, no other useful information could be gathered.

### PEStudio -

![[Attachments/Pasted image 20220910133506.png]]

We can observe a few networking commands/processes that was exposed in the strings. 

### Network Indicators

#### Wireshark

![[Attachments/Pasted image 20220910134914.png]]

We can see that the malware makes a DNS request to the _aaaaaaaaaaaaaaaaaaaa.kadusus.local_ . Since this cannot be resolved,  we can manually resolve this in our _/etc/hosts_ folder.

![[Attachments/Pasted image 20220910140207.png]]

#### Host based Indicators

Now filter out the network traffic in Procmon

> **_Procmon Filter_**
> - Process name contains _RAT.Unknown2.exe_
> - Operation contains _TCP_

![[Attachments/Pasted image 20220910140956.png]]

We can observe the network connections it tries initiates with the domain. It tries to do that on https which it port 443 and since it points to the same machine, we can try to listen in on what the connection offers.

Listen on port 443 and run the binary again.

Running the binary again, we get a TCP connect

![[Attachments/Pasted image 20220910142218.png]]


We see that it gives us a reverse shell.

![[Attachments/Pasted image 20220910142347.png]]


Using the process tree, we can see the subprocesses spawned

![[Attachments/Pasted image 20220910145722.png]]

To view all the new processed spawed under this parent process, we can filter out the Parent PID in procmon

![[Attachments/Pasted image 20220910150550.png]]


Final Process of the malware :
- Tries resolving hostname 
	- If it gets resolved
		- Tries connecting to the hostname on port 443
		- Gives a reverse shell 
- Or else,
	- Exits out of the program