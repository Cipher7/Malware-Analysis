# Maldoc Analysis

## Malicious Excel Documents

__Binary Used__ : _sheetsForFinancial.xlsm_

A .xlsm file is actually a zip file with all the data in it like the themes, values, macros etc. This can be unzipped easily to reveal it's contents.

![[Attachments/Pasted image 20220918011323.png]]

We observer a vbaproject binary present in the subfolder. We can use ___Oledump.py___ to carve and extract the macros.

![[Attachments/Pasted image 20220918011520.png]]

Oledump identifies that the stream _A3_ contains macro in it.

We can dump the strings of this stream using the command : 

> oledump.py -s 3 -S sheetsForFinancial.xlsm

![[Attachments/Pasted image 20220918011705.png]]


To recover the macros, we can use this command :

>  oledump.py -s 3 --vbadecompresscorrupt sheetsForFinancial.xlsm

![[Attachments/Pasted image 20220918011829.png]]

We can see it has successfully extracted the entire macros which was embedded in the excel file.


## Word Documents

### docm files

For .docm files , we can follow the same methodology as the above .xlsm file to extract and carve out the macro.

### docx files

Rename the file extension to .zip and open with the archiver.

![[Attachments/Pasted image 20220918012356.png]]

![[Attachments/Pasted image 20220918012450.png]]

We can see the template points to a remote location which has a .dotm file which contains the payload. 

This was we can execute macros even with .docx files.

